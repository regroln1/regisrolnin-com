<script>
  // Smooth scroll for TOC links
  function handleTOCClick(event: Event) {
    const target = (event.target as Element).closest('a[href^="#"]') as HTMLAnchorElement;
    if (!target) return;
    
    event.preventDefault();
    const targetId = target.getAttribute('href')?.substring(1);
    if (!targetId) return;
    
    const targetElement = document.getElementById(targetId);
    
    if (targetElement) {
      const headerOffset = 120;
      const elementPosition = targetElement.getBoundingClientRect().top;
      const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
      
      window.scrollTo({
        top: offsetPosition,
        behavior: 'smooth'
      });
      
      document.querySelectorAll('.toc a').forEach(link => link.classList.remove('active'));
      target.classList.add('active');
    }
  }
  
  // Generate IDs for headings
  function generateHeadingIds() {
    const headings = document.querySelectorAll('article h1, article h2, article h3, article h4, article h5, article h6');
    headings.forEach(heading => {
      if (!(heading as HTMLElement).id) {
        const text = heading.textContent || heading.innerHTML;
        const id = text
          .toLowerCase()
          .replace(/[^a-z0-9\s-]/g, '')
          .replace(/\s+/g, '-')
          .replace(/-+/g, '-')
          .replace(/^-|-$/g, '');
        (heading as HTMLElement).id = id;
      }
    });
  }
  
  document.addEventListener('click', handleTOCClick);
  document.addEventListener('DOMContentLoaded', generateHeadingIds);
</script>